# Neovimプラグイン開発計画 - AutoFileName.nvim

## 1. 初期設定とプロジェクト構造の確立

*   [ ] **1.1. プロジェクトディレクトリの作成**:
    *   [x] `AutoFileName.nvim/` ディレクトリを作成。
    *   [ ] `lua/autofilename/init.lua` や `plugin/autofilename.lua` など、主要なエントリーポイントファイルの配置を決定。
*   [ ] **1.2. 設定ファイルの準備**:
    *   [ ] ユーザー設定を管理するためのLuaモジュール（例: `lua/autofilename/config.lua`）の雛形を作成。
*   [ ] **1.3. コマンド定義の検討**:
    *   [ ] ユーザーがプラグインを操作するためのNeovimコマンド（例: `:AutoSaveNote`）を定義する方法を検討。

## 2. コア機能の実装 (FEAT-001, FEAT-002, FEAT-003, FEAT-004)

*   [x] **2.1. ファイル保存ディレクトリの管理**:
    *   [x] デフォルトの保存ディレクトリを設定し、ユーザーがこれを変更できるようにするロジックを実装 (FEAT-004)。
    *   [x] ディレクトリの存在チェックと作成機能。
*   [x] **2.2. ファイル拡張子の管理**:
    *   [x] デフォルトの拡張子（例: `.md`）を設定し、ユーザーがこれを変更できるようにするロジックを実装 (FEAT-003)。
*   [x] **2.3. ファイル名自動生成機能の実装**:
    *   [x] ユーザーが設定したフォーマット文字列（例: `os.date('%Y%m%dT%H%M%S') .. '_note'`）に基づき、ファイル名を自動生成するロジックを実装 (FEAT-001)。
        *   [x] `{{first_line}}` プレースホルダーをバッファの最初の空でない行から抽出し、ファイル名に適した形にサニタイズして置換。
        *   [x] ファイル名の最大長を設定し、超える場合は切り詰める機能を追加。
        *   **注**: 日時やLuaコードの実行結果をファイル名に含める場合は、`init.lua` の設定内で `os.date()` や `vim.fn` などのLua関数を直接使用する形式に移行した。これにより、`{{strftime: ...}}` や `{{lua: ...}}` プレースホルダーの解析ロジックは削除される。
        *   **注**: フォーマット文字列内の正規表現パターンに基づいて、ユーザーにファイル名の一部を対話的に入力・選択させる機能は、本フェーズでは実装しない（後述の「追加機能の検討」で扱う）。
*   [x] **2.4. ファイル名衝突解決機能の実装**:
    *   [x] 同名ファイルが存在する場合、連番を付与してユニークなファイル名を生成するロジック (例: `filename-1.md`)。

## 4. 設定とカスタマイズ機能の強化 (OPT-001)

*   [ ] **4.1. 設定オプションの集約**:
    *   [ ] `init.lua` または専用の`config.lua`で、全てのカスタマイズ可能なオプション（ファイル名フォーマット、保存ディレクトリ、拡張子など）を一元的に管理する。
    *   [ ] デフォルト値の設定と、ユーザーによるオーバーライドを可能にする。
*   [x] **4.2. 国際化 (i18n) のサポート強化**:
    *   [x] 中国語 (簡体字) 翻訳ファイルの追加 (`lua/autofilename/i18n/zh-CN.lua`)。

## 5. テストとデバッグ (MAIN-002)

*   [ ] **5.1. ユニットテストの作成**:
    *   [ ] ファイル名生成ロジック、パス解決などのコア機能に対してユニットテストを作成。
    *   [ ] `plenary.nvim` のテストユーティリティの利用検討。
*   [ ] **5.2. 手動テスト**:
    *   [ ] プラグインのインストール、設定、各コマンドの実行など、手動での動作確認を行う。
*   [ ] **5.3. エラーハンドリング**:
    *   [ ] ファイル書き込み失敗、ディレクトリ作成失敗、無効な設定値などのエラーケースに対する適切なエラーメッセージ表示と処理。

## 6. ドキュメント作成とリリース準備 (USAB-002)

*   [ ] **6.1. ヘルプドキュメントの作成**:
    *   [ ] プラグインのインストール方法、設定方法、提供されるコマンド、オプションについて説明する `:help` ドキュメント（例: `doc/autofilename.txt`）を作成。
*   [x] **6.2. READMEの作成**:
    *   [x] プロジェクトの概要、機能、簡単な使用例、インストール方法などを記述した `README.md` を作成。
    *   [x] 各言語版の `README` ファイル（`README_ja.md`, `README_zh-CN.md`, `README_en.md` など）を作成。
*   [ ] **6.3. リリースパッケージの準備**:
    *   [ ] プラグインマネージャー（packer.nvim, lazy.nvimなど）で利用できるよう、ファイル構造が適切であることを確認。

## 7. 追加機能の検討（将来）

*   [ ] **7.1. ファイル衝突解決**: 同一秒での保存時などに、ファイル名に連番を付与するなどのシンプルな衝突解決策の実装。
*   [ ] **7.2. AIによるファイル名提案**: 要件のスコープ外としたAI機能について、技術調査と実現可能性の検討。
*   [ ] **7.3. インタラクティブなファイル名要素入力機能**: ファイル名の一部を対話的に入力・選択させる機能。

## 8. スケジュール（概算）

*   フェーズ1 (初期設定, コア機能): [例: 1日]
*   フェーズ2 (検証, 設定強化, テスト): [例: 0.5日]
*   フェーズ3 (ドキュメント, リリース準備): [例: 0.5日]

---
**注**: この計画はあくまで叩き台であり、開発を進める中で適宜見直しや調整が必要となる場合があります。
